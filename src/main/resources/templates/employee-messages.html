<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Mes Messages</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body class="bg-light">
	<nav class="navbar navbar-expand-lg navbar-dark bg-primary py-3">
		<div class="container">
			<span class="navbar-text fw-bold fs-5 me-auto" th:text="${user.prenom + ' ' + user.nom}">Ismaila</span>
			<a class="navbar-brand fw-bold mx-auto flex-fill text-center" href="/">Conversation</a>
			<div class="d-flex">
				<a th:href="@{/employee/profile}" class="btn btn-outline-light btn-lg px-4 me-2 shadow">
					<i class="bi bi-person me-2"></i>Profil
				</a>
				<a th:href="@{/employee/logout}" class="btn btn-outline-light btn-lg px-4 shadow">
					<i class="bi bi-box-arrow-right me-2"></i>Déconnexion
				</a>
			</div>
		</div>
	</nav>

	<div class="container-fluid mt-4 px-4">
		<div class="row">
			<div class="col-12 col-lg-6 mx-auto">
				<div class="d-flex align-items-center justify-content-between mb-4">
					<div class="d-flex align-items-center">
						<i class="bi bi-chat-dots-fill fs-2 text-primary me-3"></i>
						<h2 class="mb-0 fw-bold">Mes Messages</h2>
					</div>
					<span th:if="${nonLusCount > 0}" class="badge bg-danger fs-6 px-2 py-1"
						th:text="${nonLusCount}">3</span>
				</div>

				<div class="list-group list-group-flush shadow-lg border-0 rounded-4 overflow-hidden"
					style="height: 70vh; overflow-y: auto;">
					<a th:each="employee : ${employees}" th:href="@{/employee/conversation/{id}(id=${employee.id})}"
						class="list-group-item list-group-item-action border-0 p-0 position-relative">
						<div class="d-flex align-items-start p-4 hover-bg-light">
							<div class="me-3 mt-1">
								<i class="bi bi-person-circle fs-2 text-primary"></i>
							</div>
							<div class="flex-grow-1">
								<div class="d-flex justify-content-between align-items-start">
									<div>
										<h6 class="mb-1 fw-bold" th:text="${employee.prenom + ' ' + employee.nom}">Nom
										</h6>
										<p class="mb-1 small text-muted" th:text="${employee.poste}">Poste</p>
									</div>
									<span
										th:if="${nonLusParContact != null and nonLusParContact[employee.id] != null and #lists.size(nonLusParContact[employee.id]) > 0}"
										class="badge bg-danger position-absolute top-0 end-0 mt-2 me-2 fs-6 px-2 py-1 shadow"
										th:text="${#lists.size(nonLusParContact[employee.id])}">2</span>
									<small class="text-muted">En ligne</small>
								</div>
								<small class="text-black-50">Cliquez pour voir la conversation</small>
							</div>
						</div>
					</a>
					<div th:if="${#lists.isEmpty(employees)}" class="text-center p-5">
						<i class="bi bi-chat-square-text fs-1 text-muted mb-3"></i>
						<h5 class="text-muted">Aucune conversation</h5>
						<p class="text-muted mb-0">Envoyez un message à un collègue</p>
					</div>
				</div>

				<div class="card shadow-lg border-0 mt-4">
					<div class="card-body p-4">
						<h6 class="fw-bold text-primary mb-3"><i class="bi bi-people me-2"></i>Tous les collègues</h6>
						<div class="row g-2">
							<div th:each="allEmployee : ${allEmployees}" class="col-6">
								<a th:href="@{/employee/conversation/{id}(id=${allEmployee.id})}"
									class="btn btn-outline-primary btn-sm w-100 p-2">
									<small th:text="${allEmployee.prenom + ' ' + allEmployee.nom}">Nom</small>
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<style>
		.hover-bg-light:hover {
			background-color: #f8f9fa !important;
			transition: all 0.2s ease;
		}

		.list-group-item {
			border-bottom: 1px solid #f0f0f0;
		}

		.list-group-item:last-child {
			border-bottom: none;
		}
	</style>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>