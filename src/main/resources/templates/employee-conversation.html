<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Conversation</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body class="bg-light">
	<nav class="navbar navbar-expand-lg navbar-dark bg-primary py-3">
		<div class="container">
			<div class="d-flex align-items-center">
				<a href="/employee/messages" class="btn btn-outline-light btn-lg px-4 me-3 shadow">
					<i class="bi bi-arrow-left-circle fs-5 me-2"></i>Messages
				</a>
				<span class="navbar-text fw-bold fs-5" th:text="${user.prenom + ' ' + user.nom}">Ismaila</span>
			</div>
			<a class="navbar-brand fw-bold mx-auto flex-fill text-center" href="/">Conversation</a>
			<div class="d-flex">
				<a th:href="@{/employee/profile}" class="btn btn-outline-light btn-lg px-4 me-2 shadow">
					<i class="bi bi-person me-2"></i>Profil
				</a>
				<a th:href="@{/employee/logout}" class="btn btn-outline-light btn-lg px-4 shadow">
					<i class="bi bi-box-arrow-right me-2"></i>DÃ©connexion
				</a>
			</div>
		</div>
	</nav>

	<div class="container-fluid mt-4 px-4">
		<div class="row">
			<div class="col-12">
				<div class="card shadow-lg border-0 mb-4" style="height: 70vh;">
					<div class="card-header bg-primary text-white py-3 d-flex align-items-center">
						<div class="me-3"><i class="bi bi-person-circle fs-2"></i></div>
						<div>
							<h6 class="mb-0 fw-bold" th:text="${interlocuteur.prenom + ' ' + interlocuteur.nom}">Nom
							</h6>
							<small class="opacity-75" th:text="${interlocuteur.poste}">Poste</small>
						</div>
					</div>
					<div class="card-body p-3 pt-0"
						style="height: calc(100% - 60px); overflow-y: auto; background: #f0f2f5;">
						<div th:if="${#lists.isEmpty(messages)}" class="text-center p-5 text-muted">
							<i class="bi bi-chat-square-text fs-1 mb-3 opacity-50"></i>
							<h5 class="mb-1">Aucune conversation</h5>
							<p class="mb-0">Commencez par envoyer un message !</p>
						</div>
						<div th:each="msg : ${messages}" class="mb-3 d-flex"
							th:classappend="${msg.sender.id == user.id} ? 'justify-content-end' : 'justify-content-start'">
							<div
								th:class="${msg.sender.id == user.id} ? 'bg-primary text-white rounded-3 p-3 max-w-75' : 'bg-white rounded-3 p-3 shadow-sm max-w-75 border'">
								<small class="opacity-75 d-block mb-1"
									th:text="${#temporals.format(msg.date, 'HH:mm')}">14:30</small>
								<p class="mb-0" th:text="${msg.contenu}">Message</p>
							</div>
						</div>
					</div>
				</div>

				<form th:action="@{/employee/send}" method="post" class="card shadow-lg border-0">
					<input type="hidden" name="receiverId" th:value="${interlocuteur.id}">
					<div class="card-body p-4">
						<div class="input-group">
							<input type="text" name="contenu" class="form-control border-0 shadow-none"
								placeholder="Tapez votre message..." required maxlength="500">
							<button type="submit" class="btn btn-primary px-4">
								<i class="bi bi-send-fill fs-5"></i>
							</button>
						</div>
					</div>
				</form>

				<div class="text-center mt-3">
					<a th:href="@{/employee/conversation/{id}(id=${interlocuteur.id})}"
						class="btn btn-outline-primary px-4">
						<i class="bi bi-arrow-clockwise me-1"></i>Actualiser
					</a>
				</div>
			</div>
		</div>
	</div>

	<style>
		.max-w-75 {
			max-width: 75%;
		}

		.form-control:focus {
			box-shadow: none !important;
			border-color: #86b7fe !important;
			background-color: white;
		}

		.card-body::-webkit-scrollbar {
			width: 6px;
		}

		.card-body::-webkit-scrollbar-track {
			background: #f1f1f1;
		}

		.card-body::-webkit-scrollbar-thumb {
			background: #c1c1c1;
			border-radius: 3px;
		}
	</style>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script>window.scrollTo(0, document.body.scrollHeight);</script>
</body>

</html>